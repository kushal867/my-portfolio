{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}My Portfolio{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/site.css' %}">
  <script>
    // Apply saved theme early to avoid flash
    (function() {
      try {
        var saved = localStorage.getItem('theme') || 'light';
        if (saved === 'dark') document.documentElement.setAttribute('data-theme', 'dark');
      } catch (e) {}
    })();
  </script>
</head>
<body class="bg-light text-dark page-transition">
  <div id="topProgress"></div>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="/">My Portfolio</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link {% if request.path|slice:':10' == '/projects/' %}active{% endif %}" href="/projects/">Projects</a></li>
          <li class="nav-item"><a class="nav-link {% if request.path|slice:':6' == '/blog/' %}active{% endif %}" href="/blog/">Blog</a></li>
          <li class="nav-item"><a class="nav-link {% if request.path|slice:':6' == '/quiz/' %}active{% endif %}" href="/quiz/">Quiz</a></li>
          {% if user.is_authenticated %}
            <li class="nav-item"><a class="nav-link" href="/accounts/logout/">Logout</a></li>
          {% else %}
            <li class="nav-item"><a class="nav-link" href="/accounts/login/">Login</a></li>
            <li class="nav-item"><a class="nav-link" href="/accounts/register/">Register</a></li>
          {% endif %}
        </ul>
        <div class="ms-3">
          <button id="themeToggle" class="btn btn-outline-light btn-sm" type="button">Toggle theme</button>
        </div>
      </div>
    </div>
  </nav>

  <main style="padding-top: 4.5rem;">
    {% block breadcrumbs %}{% endblock %}
    {% block content %}{% endblock %}
  </main>

  <footer class="bg-dark text-white text-center py-3 mt-5 footer-gradient">
    <div class="container d-flex flex-column align-items-center gap-2">
      <div class="d-flex gap-3">
        <a href="https://github.com/kushal867" class="text-white-50" target="_blank" aria-label="GitHub">
          <svg class="invert-on-dark" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 .5a12 12 0 0 0-3.79 23.39c.6.11.82-.26.82-.58v-2.02c-3.34.73-4.04-1.61-4.04-1.61-.55-1.4-1.35-1.77-1.35-1.77-1.1-.76.08-.75.08-.75 1.22.09 1.86 1.26 1.86 1.26 1.08 1.86 2.84 1.33 3.53 1.02.11-.78.42-1.33.76-1.64-2.66-.3-5.46-1.33-5.46-5.9 0-1.3.47-2.36 1.24-3.19-.12-.3-.54-1.52.12-3.17 0 0 1-.32 3.3 1.22a11.5 11.5 0 0 1 6 0c2.29-1.54 3.29-1.22 3.29-1.22.67 1.65.25 2.87.13 3.17.77.83 1.23 1.9 1.23 3.19 0 4.58-2.8 5.59-5.48 5.89.43.37.81 1.1.81 2.22v3.29c0 .32.22.7.83.58A12 12 0 0 0 12 .5Z"/></svg>
        </a>
        <a href="https://www.linkedin.com/in/kushal-sapkota-developer/" class="text-white-50" target="_blank" aria-label="LinkedIn">
          <svg class="invert-on-dark" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM.5 8h4V24h-4V8zm7.5 0h3.8v2.2h.1c.5-1 1.8-2.2 3.8-2.2 4 0 4.7 2.6 4.7 5.9V24h-4v-7c0-1.7 0-3.9-2.4-3.9s-2.8 1.8-2.8 3.8V24h-4V8z"/></svg>
        </a>
        <a href="mailto:kushalsapkota577@example.com" class="text-white-50" aria-label="Email">
          <svg class="invert-on-dark" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M20 4H4c-1.1 0-2 .9-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg>
        </a>
      </div>
      <p class="mb-0">&copy; {{ now|date:"Y" }} My Portfolio. Built with Django + Bootstrap.</p>
    </div>
  </footer>

  <button id="backToTop" class="btn btn-primary btn-glow rounded-circle" type="button" aria-label="Back to top">
    &#8679;
  </button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function() {
      var btn = document.getElementById('themeToggle');
      if (!btn) return;
      btn.addEventListener('click', function() {
        var dark = document.documentElement.getAttribute('data-theme') === 'dark';
        var next = dark ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        try { localStorage.setItem('theme', next); } catch (e) {}
      });
    })();
  </script>
  <script>
    // Page transition and simulated progress for navigation
    (function() {
      var root = document.body;
      function ready() { root.classList.add('is-ready'); }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', ready);
      } else { ready(); }

      var bar = document.getElementById('topProgress');
      var timer;
      function startProgress() {
        if (!bar) return;
        bar.style.width = '10%';
        timer = setInterval(function() {
          var w = parseFloat(bar.style.width);
          if (w < 90) bar.style.width = (w + Math.random() * 10) + '%';
        }, 300);
      }
      function endProgress() {
        if (!bar) return;
        clearInterval(timer);
        bar.style.width = '100%';
        setTimeout(function() { bar.style.width = '0%'; }, 300);
      }
      window.addEventListener('beforeunload', startProgress);
      window.addEventListener('load', endProgress);
    })();
  </script>
  <script>
    // Simple scroll-reveal: toggles .is-visible on .reveal elements
    (function() {
      if (!('IntersectionObserver' in window)) {
        var fallback = document.querySelectorAll('.reveal');
        for (var i = 0; i < fallback.length; i++) {
          fallback[i].classList.add('is-visible');
        }
        return;
      }
      var observer = new IntersectionObserver(function(entries, obs) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            obs.unobserve(entry.target);
          }
        });
      }, { threshold: 0.2 });
      var targets = document.querySelectorAll('.reveal');
      for (var j = 0; j < targets.length; j++) observer.observe(targets[j]);
    })();
  </script>
  <script>
    // Card tilt and subtle hero parallax
    (function() {
      var cards = document.querySelectorAll('.hover-rise.card');
      var tilt = function(e) {
        var rect = this.getBoundingClientRect();
        var cx = rect.left + rect.width / 2;
        var cy = rect.top + rect.height / 2;
        var dx = (e.clientX - cx) / rect.width;
        var dy = (e.clientY - cy) / rect.height;
        this.style.transform = 'translateY(-4px) rotateX(' + (-dy * 6) + 'deg) rotateY(' + (dx * 6) + 'deg)';
      };
      var reset = function() { this.style.transform = ''; };
      for (var i = 0; i < cards.length; i++) {
        cards[i].addEventListener('mousemove', tilt);
        cards[i].addEventListener('mouseleave', reset);
      }

      var header = document.querySelector('header.hero-blobs');
      if (!header) return;
      header.addEventListener('mousemove', function(e) {
        var b1 = header.querySelector('.blob-1');
        var b2 = header.querySelector('.blob-2');
        if (!b1 || !b2) return;
        var rect = header.getBoundingClientRect();
        var rx = (e.clientX - rect.left) / rect.width - 0.5;
        var ry = (e.clientY - rect.top) / rect.height - 0.5;
        b1.style.transform = 'translate(' + (-10 + rx * 8) + '%, ' + (-10 + ry * 8) + '%) scale(1)';
        b2.style.transform = 'translate(' + (10 + rx * 8) + '%, ' + (20 + ry * 8) + '%) scale(1)';
      });
    })();
  </script>
  <script>
    // Project filtering chips (client-side)
    (function() {
      var chips = document.querySelectorAll('.filter-chip');
      if (!chips.length) return;
      var cards = document.querySelectorAll('.project-card');
      function setActive(target) {
        for (var i = 0; i < chips.length; i++) chips[i].classList.remove('active');
        target.classList.add('active');
      }
      function filter(tech) {
        for (var i = 0; i < cards.length; i++) {
          var card = cards[i];
          var techs = (card.getAttribute('data-techs') || '').toLowerCase();
          var show = tech === 'all' || techs.indexOf(tech) !== -1;
          card.style.transition = 'opacity 200ms ease, transform 200ms ease';
          if (show) {
            card.style.opacity = '1';
            card.style.transform = 'scale(1)';
            card.style.display = '';
          } else {
            card.style.opacity = '0';
            card.style.transform = 'scale(0.98)';
            setTimeout((function(c){ return function(){ c.style.display = 'none'; };})(card), 200);
          }
        }
      }
      for (var j = 0; j < chips.length; j++) {
        chips[j].addEventListener('click', function() {
          setActive(this);
          var tech = this.getAttribute('data-tech');
          // Show all first to allow animation
          for (var k = 0; k < cards.length; k++) { cards[k].style.display = ''; }
          filter(tech);
        });
      }
    })();
  </script>
  <script>
    // Back to top behavior
    (function() {
      var btn = document.getElementById('backToTop');
      if (!btn) return;
      var toggle = function() {
        if (window.scrollY > 400) btn.classList.add('is-visible'); else btn.classList.remove('is-visible');
      };
      window.addEventListener('scroll', toggle);
      toggle();
      btn.addEventListener('click', function() { window.scrollTo({ top: 0, behavior: 'smooth' }); });
    })();
  </script>
</body>
</html>


